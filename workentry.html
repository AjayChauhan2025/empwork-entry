<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Work Entry Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            margin: 0;
            padding: 0;
        }

        .main-container {
            max-width: 1100px;
            width: 100%;
        }

        h2 {
            margin-top: 0;
        }

        .card {
            background: #e6f2ff;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            box-shadow: 0 0 6px rgba(0, 0, 0, 0.1);
        }

        .card-white {
            background: white;
        }

        .form-group {
            margin-bottom: 10px;
        }

            .form-group label {
                display: block;
                font-weight: bold;
            }

            .form-group input {
                width: 100%;
                padding: 6px;
                margin-top: 4px;
                border: 1px solid #ccc;
                border-radius: 4px;
            }

        button {
            padding: 8px 14px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .btn-save {
            background: green;
            color: white;
        }

        .btn-delete {
            background: red;
            color: white;
        }

        .btn-view {
            background: #007bff;
            color: white;
        }

        .logout-btn {
            background: #d9534f;
            color: white;
        }

        .update-btn {
            background: #28a745;
            color: white;
        }

        .dashboard-btn {
            background: #3f7fbf;
            color: white;
            margin: 10px; /* gap ‡™µ‡™ß‡™æ‡™∞‡´ç‡™Ø‡´ã */
            padding: 12px 20px; /* button height ‡™Æ‡´ã‡™ü‡´Ä ‡™ï‡™∞‡´Ä */
            font-size: 16px;
        }

        table {
            border-collapse: collapse;
            margin-top: 15px;
            width: 100%;
        }

        table, th, td {
            border: 1px solid #ccc;
        }

        th, td {
            padding: 6px;
            text-align: center;
        }

        th {
            background: #3f7fbf;
            color: white;
        }
    </style>
</head>
<body>
    <div class="main-container">

        <!-- Dashboard -->
        <div id="dashboard" class="section card" style="text-align: center;">
            <h2>Dashboard</h2>
            <button class="dashboard-btn" onclick="showSection('add-entry')">‚ûï Add Entry</button>
            <button class="dashboard-btn" onclick="showEntries()">üìÑ View Entry</button>
            <button class="dashboard-btn" onclick="showSection('update-profile')">üõ† Update Profile</button>
            <button class="dashboard-btn logout-btn" onclick="logout()">üö™ Logout</button>
        </div>

        <!-- Add Entry -->
        <div id="add-entry" class="section card" style="display:none;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h2>Add Work Entry</h2>
                <button class="logout-btn" onclick="showSection('dashboard')">‚¨Ö Back</button>
            </div>
            <div class="form-group">
                <label>Name:</label>
                <input type="text" id="name" readonly>
                <label>Date:</label>
                <input type="date" id="date" value="">
            </div>
            <div class="form-group"><label>ActivePart:</label><input type="number" id="active"></div>
            <div class="form-group"><label>Marking:</label><input type="number" id="marking"></div>
            <div class="form-group"><label>ReMarking:</label><input type="number" id="remarking"></div>
            <div class="form-group"><label>OutParty:</label><input type="number" id="outparty"></div>
            <div>
                <button class="btn-save" onclick="saveEntry()">üíæ Save Entry</button>
            </div>
        </div>


        <!-- View Entry -->
        <div id="view-entry" class="section card card-white" style="display:none;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h2>All Entries</h2>
                <div>
                    <button class="btn-delete" onclick="deleteAllEntries()">üóë Delete All Entries</button>
                    <button class="logout-btn" onclick="showSection('dashboard')">‚¨Ö Back</button>
                </div>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Date</th>
                        <th>Active</th>
                        <th>Marking</th>
                        <th>ReMarking</th>
                        <th>OutParty</th>
                        <th>ActivePartSalary</th>
                        <th>MarkingSalary</th>
                        <th>ReMarkingSalary</th>
                        <th>OutPartySalary</th>
                        <th>TotalSalary</th>
                    </tr>
                </thead>
                <tbody id="entries-body"></tbody>
                <tfoot>
                    <tr id="total-row">
                        <th colspan="2">TOTAL</th>
                        <th id="t-active">0</th>
                        <th id="t-marking">0</th>
                        <th id="t-remarking">0</th>
                        <th id="t-outparty">0</th>
                        <th id="t-activeSalary">0.00</th>
                        <th id="t-markingSalary">0.00</th>
                        <th id="t-remarkingSalary">0.00</th>
                        <th id="t-outpartySalary">0.00</th>
                        <th id="t-totalSalary">0.00</th>
                    </tr>
                </tfoot>
            </table>
        </div>


        <!-- Update Profile -->
        <div id="update-profile" class="section card card-white" style="display:none;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h2>Update Profile</h2>
                <button class="logout-btn" onclick="showSection('dashboard')">‚¨Ö Back</button>
            </div>
            <div class="form-group">
                <label>User name:</label>
                <input type="text" id="username">
                <label>New Password:</label>
                <input type="password" id="password">
            </div>
            <button class="update-btn" onclick="updateProfile()">üîí Update Profile</button>
        </div>

    </div>

    <script>
        window.onload = function () {
            let loggedUser = JSON.parse(localStorage.getItem('loggedUser') || '{}');

            // admin user manage ‡™Æ‡™æ‡™Ç save ‡™•‡™Ø‡´á‡™≤ fullname field load ‡™ï‡™∞‡´ã
            if (loggedUser.fullname && loggedUser.fullname.trim() !== "") {
                document.getElementById('name').value = loggedUser.fullname;
            } else if (loggedUser.fullName && loggedUser.fullName.trim() !== "") {
                // ‡™ú‡´ã ‡™ï‡´ç‡™Ø‡™æ‡™Ç‡™ï fullName key ‡™•‡´Ä save ‡™•‡™Ø‡´á‡™≤‡´Å‡™Ç ‡™π‡´ã‡™Ø ‡™§‡´ã fallback
                document.getElementById('name').value = loggedUser.fullName;
            } else if (loggedUser.username) {
                document.getElementById('name').value = loggedUser.username;
            } else {
                document.getElementById('name').value = "";
            }
        };

        function logout() {
            if (confirm("Do you really want to logout?")) {
                localStorage.removeItem("loggedUser");
                window.location.href = "index.html";
            }
        }
        function showSection(id) {
            document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
            document.getElementById(id).style.display = 'block';
        }


        function saveEntry() {
            let name = document.getElementById('name').value.trim();
            let date = document.getElementById('date').value;

            let activeInput = document.getElementById('active').value.trim();
            let markingInput = document.getElementById('marking').value.trim();
            let remarkingInput = document.getElementById('remarking').value.trim();
            let outpartyInput = document.getElementById('outparty').value.trim();

            // 1. ‡™¨‡™ß‡™æ fields ‡™ñ‡™æ‡™≤‡´Ä ‡™õ‡´á
            if (activeInput === '' && markingInput === '' && remarkingInput === '' && outpartyInput === '') {
                alert("Please enter your pcs");
                return;
            }

            let active = +activeInput || 0;
            let marking = +markingInput || 0;
            let remarking = +remarkingInput || 0;
            let outparty = +outpartyInput || 0;

            let rates = { active: 2.6, marking: 2.3, remarking: 3.0, outparty: 2.6 };
            let activeSalary = active * rates.active;
            let markingSalary = marking * rates.marking;
            let remarkingSalary = remarking * rates.remarking;
            let outpartySalary = outparty * rates.outparty;
            let totalSalary = activeSalary + markingSalary + remarkingSalary + outpartySalary;

            let entries = JSON.parse(localStorage.getItem('entries') || '[]');

            // 2. Duplicate check (same name + date)
            let existingIndex = entries.findIndex(e => e.date === date && e.name === name);
            if (existingIndex !== -1) {
                let confirmUpdate = confirm("‡™Ü ‡™§‡™æ‡™∞‡´Ä‡™ñ‡™®‡´Ä entry ‡™™‡™π‡´á‡™≤‡´á‡™•‡´Ä save ‡™õ‡´á. ‡™∂‡´Å‡™Ç entry ‡™∏‡´Å‡™ß‡™æ‡™∞‡™µ‡´Ä ‡™õ‡´á?");
                if (!confirmUpdate) {
                    return; // save ‡™® ‡™•‡™æ‡™Ø
                } else {
                    entries.splice(existingIndex, 1); // ‡™ú‡´Ç‡™®‡´Ä entry delete
                }
            }

            // 3. Save entry
            let entry = {
                name, date, active, marking, remarking, outparty,
                activeSalary, markingSalary, remarkingSalary, outpartySalary, totalSalary
            };

            entries.push(entry);
            localStorage.setItem('entries', JSON.stringify(entries));

            alert("‚úÖ Entry Saved!");
        }


        function showEntries() {
            showSection('view-entry');
            let entries = JSON.parse(localStorage.getItem('entries') || '[]');
            let tbody = document.getElementById('entries-body');
            tbody.innerHTML = '';
            let total = {
                active: 0, marking: 0, remarking: 0, outparty: 0,
                activeSalary: 0, markingSalary: 0, remarkingSalary: 0, outpartySalary: 0, totalSalary: 0
            };

            entries.forEach((e, i) => {
                tbody.innerHTML += `
                    <tr>
                        <td>${i + 1}</td>
                        <td>${e.date}</td>
                        <td>${e.active}</td>
                        <td>${e.marking}</td>
                        <td>${e.remarking}</td>
                        <td>${e.outparty}</td>
                        <td>${e.activeSalary.toFixed(2)}</td>
                        <td>${e.markingSalary.toFixed(2)}</td>
                        <td>${e.remarkingSalary.toFixed(2)}</td>
                        <td>${e.outpartySalary.toFixed(2)}</td>
                        <td>${e.totalSalary.toFixed(2)}</td>
                    </tr>
                `;
                total.active += e.active;
                total.marking += e.marking;
                total.remarking += e.remarking;
                total.outparty += e.outparty;
                total.activeSalary += e.activeSalary;
                total.markingSalary += e.markingSalary;
                total.remarkingSalary += e.remarkingSalary;
                total.outpartySalary += e.outpartySalary;
                total.totalSalary += e.totalSalary;
            });

            // Update fixed total row in <tfoot>
            document.getElementById('t-active').textContent = total.active;
            document.getElementById('t-marking').textContent = total.marking;
            document.getElementById('t-remarking').textContent = total.remarking;
            document.getElementById('t-outparty').textContent = total.outparty;
            document.getElementById('t-activeSalary').textContent = total.activeSalary.toFixed(2);
            document.getElementById('t-markingSalary').textContent = total.markingSalary.toFixed(2);
            document.getElementById('t-remarkingSalary').textContent = total.remarkingSalary.toFixed(2);
            document.getElementById('t-outpartySalary').textContent = total.outpartySalary.toFixed(2);
            document.getElementById('t-totalSalary').textContent = total.totalSalary.toFixed(2);
        }


        function deleteAllEntries() {
            if (confirm("‚ùå Delete all entries?")) {
                localStorage.removeItem('entries');
                showEntries();
                alert("üóë All entries deleted!");
            }
        }

        function updateProfile() {
            let newName = document.getElementById("newFullName").value.trim();
            let newPassword = document.getElementById("newPassword").value.trim();
            let currentUser = JSON.parse(localStorage.getItem("loggedUser") || "null");

            if (!currentUser) {
                alert("‡™Ø‡´Ç‡™ù‡™∞ ‡™Æ‡™≥‡´ç‡™Ø‡´ã ‡™®‡™π‡´Ä‡™Ç.");
                return;
            }

            if (!newName || !newPassword) {
                alert("‡™®‡™µ‡´Å‡™Ç ‡™®‡™æ‡™Æ ‡™Ö‡™®‡´á ‡™™‡™æ‡™∏‡™µ‡™∞‡´ç‡™° ‡™®‡™æ‡™ñ‡´ã.");
                return;
            }

            let users = JSON.parse(localStorage.getItem("users") || "[]");

            // old username match
            let index = users.findIndex(u => u.username === currentUser.username);
            if (index !== -1) {
                users[index].fullname = newName;
                users[index].password = newPassword;

                // update logged user too
                localStorage.setItem("loggedUser", JSON.stringify(users[index]));
                localStorage.setItem("users", JSON.stringify(users));

                document.getElementById("empName").value = newName;

                alert("‚úÖ Profile successfully updated!");
            } else {
                alert("‡™Ø‡´Ç‡™ù‡™∞ ‡™Ö‡™™‡™°‡´á‡™ü ‡™•‡™Ø‡´ã ‡™®‡™π‡™ø.");
            }
        }

        // Set today's date in Add Entry form
        document.getElementById('date').value = new Date().toISOString().split('T')[0];
    </script>
    
</body>
</html>
